import { ImageResponse } from "next/og";
import { NextRequest } from "next/server";

export const runtime = "edge";

export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ title: string }> }
) {
  const { title } = await params;
  const searchParams = request.nextUrl.searchParams;
  const noTitleQuery = searchParams.get("no-title");
  const hasTitle = !(noTitleQuery || noTitleQuery === "");

  const dmFont = fetch(new URL("./dm-font.ttf", import.meta.url)).then((res) =>
    res.arrayBuffer()
  );

  return new ImageResponse(
    (
      <div
        style={{
          width: "100%",
          height: "100%",
          background: "white",
          position: "relative",
          display: "flex",
        }}
      >
        <svg
          width="1200"
          height="630"
          viewBox="0 0 1200 630"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          style={{
            position: "absolute",
            top: 0,
            left: 0,
            width: "100%",
            height: "100%",
          }}
        >
          <line
            x1="89"
            y1="4.37114e-08"
            x2="89"
            y2="630"
            stroke="#F4F0EC"
            strokeWidth="2"
          />
          <line
            x1="430.333"
            y1="4.37114e-08"
            x2="430.333"
            y2="630"
            stroke="#F4F0EC"
            strokeWidth="2"
          />
          <line
            x1="771.667"
            y1="4.37114e-08"
            x2="771.667"
            y2="630"
            stroke="#F4F0EC"
            strokeWidth="2"
          />
          <line
            x1="1113"
            y1="4.37114e-08"
            x2="1113"
            y2="630"
            stroke="#F4F0EC"
            strokeWidth="2"
          />
        </svg>

        <div
          style={{
            display: "flex",
            flexDirection: "column",
            justifyContent: "center",
            alignItems: "center",
            gap: "50px",
            width: "100%",
            height: "100%",
            position: "relative",
          }}
        >
          <svg
            width="478"
            height="134"
            viewBox="0 0 478 134"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M121.201 104.52V103.448L123.362 102.59C124.802 102.09 125.738 101.411 126.17 100.554C126.674 99.6961 126.926 98.5525 126.926 97.1233V41.1649C126.926 39.7356 126.71 38.5921 126.278 37.7345C125.846 36.8769 124.874 36.198 123.362 35.6977L121.201 34.8401V33.7681H148.963V34.8401L146.803 35.6977C145.362 36.198 144.39 36.8769 143.886 37.7345C143.454 38.5921 143.238 39.7356 143.238 41.1649V97.1233C143.238 98.5525 143.454 99.6961 143.886 100.554C144.39 101.34 145.362 102.019 146.803 102.59L148.963 103.448V104.52H121.201ZM153.476 104.52V103.448L154.989 103.019C157.509 102.305 158.77 100.554 158.77 97.7665V64.2129C158.77 62.6405 158.517 61.4972 158.013 60.7825C157.509 59.9964 156.537 59.4604 155.097 59.1745L153.476 58.7457V57.6737L171.948 51.4561L173.029 52.5281L173.893 58.9601C176.413 56.7445 179.258 54.9221 182.426 53.4929C185.595 52.0636 188.728 51.3489 191.824 51.3489C196.577 51.3489 200.214 52.6353 202.735 55.2081C205.327 57.7809 206.624 61.7116 206.624 67.0001V97.8737C206.624 100.661 207.992 102.412 210.728 103.126L211.701 103.448V104.52H186.207V103.448L187.612 103.019C190.132 102.233 191.392 100.482 191.392 97.7665V63.5697C191.392 58.9957 189.088 56.7089 184.479 56.7089C181.31 56.7089 177.853 58.2812 174.109 61.4257V97.8737C174.109 100.661 175.369 102.412 177.89 103.126L178.862 103.448V104.52H153.476ZM235.924 106.128C231.315 106.128 227.714 104.985 225.121 102.698C222.601 100.411 221.341 96.766 221.341 91.7633V55.1009H213.887V54.0289L216.48 53.6001C218.712 53.0997 220.621 52.3852 222.205 51.4561C223.861 50.5269 225.482 49.2764 227.066 47.7041L235.924 37.9489H237.004L236.68 52.9569H248.778V55.1009H236.572V93.6929C236.572 96.1941 237.112 98.0881 238.192 99.3745C239.344 100.661 240.785 101.304 242.513 101.304C244.025 101.304 245.358 100.947 246.51 100.232C247.662 99.446 248.814 98.4097 249.967 97.1233L251.047 98.1953C249.607 100.625 247.626 102.555 245.106 103.984C242.585 105.413 239.525 106.128 235.924 106.128ZM281.229 51.3489C285.909 51.3489 289.905 52.3137 293.219 54.2433C296.533 56.1013 299.052 58.6741 300.781 61.9617C302.582 65.1777 303.481 68.8581 303.481 73.0033C303.481 73.7893 303.446 74.6113 303.373 75.4689C303.3 76.2549 303.157 76.9697 302.941 77.6129H270.75C270.823 85.3313 272.19 90.9057 274.855 94.3361C277.591 97.6949 281.626 99.3745 286.954 99.3745C290.554 99.3745 293.47 98.8028 295.704 97.6593C297.937 96.5157 300.024 94.8364 301.969 92.6209L303.049 93.5857C300.816 97.5164 297.829 100.589 294.083 102.805C290.41 105.02 285.982 106.128 280.796 106.128C275.684 106.128 271.147 105.056 267.185 102.912C263.224 100.697 260.128 97.5521 257.895 93.4785C255.663 89.4049 254.547 84.5452 254.547 78.8993C254.547 73.0389 255.843 68.0721 258.436 63.9985C261.028 59.8533 264.341 56.7089 268.374 54.5649C272.479 52.4209 276.765 51.3489 281.229 51.3489ZM280.904 53.4929C278.817 53.4929 277.016 54.1361 275.503 55.4225C274.064 56.6373 272.911 58.8529 272.047 62.0689C271.255 65.2133 270.823 69.6801 270.75 75.4689H289.222C289.943 67.6789 289.654 62.0689 288.358 58.6385C287.062 55.2081 284.577 53.4929 280.904 53.4929ZM308.863 104.52V103.448L310.484 103.019C311.926 102.59 312.898 101.947 313.4 101.09C313.978 100.232 314.265 99.1244 314.265 97.7665V64.2129C314.265 62.6405 313.978 61.4972 313.4 60.7825C312.898 59.9964 311.926 59.4604 310.484 59.1745L308.863 58.7457V57.6737L327.443 51.4561L328.524 52.5281L329.496 61.7473V62.6049C330.506 60.6037 331.802 58.7813 333.385 57.1377C335.043 55.4225 336.841 54.0289 338.786 52.9569C340.803 51.8849 342.783 51.3489 344.727 51.3489C347.465 51.3489 349.553 52.0993 350.992 53.6001C352.434 55.1009 353.153 56.9948 353.153 59.2817C353.153 61.7116 352.434 63.6053 350.992 64.9633C349.626 66.2497 347.968 66.8929 346.023 66.8929C342.999 66.8929 340.336 65.3921 338.03 62.3905L337.813 62.1761C337.095 61.1756 336.266 60.6396 335.329 60.5681C334.395 60.4252 333.53 60.854 332.736 61.8545C332.018 62.4977 331.405 63.2837 330.9 64.2129C330.468 65.0705 330.036 66.0709 329.604 67.2145V97.1233C329.604 99.982 330.865 101.769 333.385 102.483L336.841 103.448V104.52H308.863ZM356.547 104.52V103.448L358.06 103.019C360.579 102.305 361.84 100.554 361.84 97.7665V64.2129C361.84 62.6405 361.587 61.4972 361.084 60.7825C360.579 59.9964 359.607 59.4604 358.168 59.1745L356.547 58.7457V57.6737L375.019 51.4561L376.099 52.5281L376.964 58.9601C379.483 56.7445 382.327 54.9221 385.497 53.4929C388.665 52.0636 391.798 51.3489 394.895 51.3489C399.648 51.3489 403.283 52.6353 405.806 55.2081C408.398 57.7809 409.694 61.7116 409.694 67.0001V97.8737C409.694 100.661 411.061 102.412 413.799 103.126L414.772 103.448V104.52H389.278V103.448L390.682 103.019C393.202 102.233 394.463 100.482 394.463 97.7665V63.5697C394.463 58.9957 392.157 56.7089 387.55 56.7089C384.379 56.7089 380.923 58.2812 377.18 61.4257V97.8737C377.18 100.661 378.438 102.412 380.96 103.126L381.933 103.448V104.52H356.547ZM446.328 106.128C440.854 106.128 436.101 105.02 432.069 102.805C428.034 100.518 424.901 97.302 422.671 93.1569C420.51 89.0117 419.43 84.1521 419.43 78.5777C419.43 73.0033 420.58 68.1793 422.887 64.1057C425.263 60.0321 428.466 56.8876 432.501 54.6721C436.606 52.4565 441.213 51.3489 446.328 51.3489C451.44 51.3489 456.012 52.4565 460.046 54.6721C464.078 56.8161 467.246 59.9249 469.552 63.9985C471.929 68.0721 473.117 72.9317 473.117 78.5777C473.117 84.2236 471.999 89.1189 469.768 93.2641C467.608 97.3377 464.51 100.518 460.479 102.805C456.517 105.02 451.799 106.128 446.328 106.128ZM446.328 103.984C448.847 103.984 450.865 103.269 452.377 101.84C453.889 100.411 454.969 97.8737 455.618 94.2289C456.336 90.5841 456.698 85.4385 456.698 78.7921C456.698 72.0741 456.336 66.8929 455.618 63.2481C454.969 59.6033 453.889 57.0661 452.377 55.6369C450.865 54.2076 448.847 53.4929 446.328 53.4929C443.805 53.4929 441.753 54.2076 440.17 55.6369C438.658 57.0661 437.54 59.6033 436.822 63.2481C436.173 66.8929 435.849 72.0741 435.849 78.7921C435.849 85.4385 436.173 90.5841 436.822 94.2289C437.54 97.8737 438.658 100.411 440.17 101.84C441.753 103.269 443.805 103.984 446.328 103.984Z"
              fill="#292F36"
            />
            <path
              d="M0 112.561H36.3464V87.0973C36.3464 81.7005 40.751 77.3295 46.1891 77.3295C51.6272 77.3295 56.0319 81.7005 56.0319 87.0973V112.561H91.8125V21.4399C41.1056 21.4399 0 62.2325 0 112.561Z"
              fill="#CDA274"
            />
          </svg>

          {hasTitle && (
            <div
              style={{
                width: "80%",
                height: "3px",
                background: "#CDA274",
              }}
            ></div>
          )}

          {hasTitle && (
            <p
              style={{
                fontSize: "100px",
                textAlign: "center",
              }}
            >
              {decodeURIComponent(title)}
            </p>
          )}
        </div>
      </div>
    ),
    {
      width: 1200,
      height: 630,
      fonts: [
        {
          name: "DM Serif Display",
          data: await dmFont,
          style: "normal",
          weight: 400,
        },
      ],
    }
  );
}
